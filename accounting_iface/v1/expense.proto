syntax = "proto3";
package accounting_iface.v1;

import "buf/validate/validate.proto";
import "common/v1/common.proto";
// import "google/protobuf/timestamp.proto";

option go_package = "github.com/pdcgo/schema/services/accounting_iface/v1;accounting_iface";

message KeyValueMetric {
  string key = 1;
  double value = 2;
}

message KeyValueMetricList {
  repeated KeyValueMetric data = 1;
}

// ## Service untuk mencatat pengeluaran dari selling, warehouse, dan internal yang baru
service ExpenseService {
  rpc ExpenseCreate(ExpenseCreateRequest) returns (ExpenseCreateResponse);
  rpc ExpenseList(ExpenseListRequest) returns (ExpenseListResponse);
  rpc ExpenseTypeList(ExpenseTypeListRequest) returns (ExpenseTypeListResponse);

  /*
   #### Untuk Metric Overview
  */
  rpc ExpenseOverviewMetric(ExpenseOverviewMetricRequest) returns (ExpenseOverviewMetricResponse);
  /*
     #### Untuk Metric berdasarkan waktu
     contoh ketika pengen metric expense daily, monthly dak kawan kawan
  */
  rpc ExpenseTimeMetric(ExpenseTimeMetricRequest) returns (ExpenseTimeMetricResponse);
}

message ExpenseTimeMetricRequest {
  uint64 team_id = 1;
  string expense_key = 2;
  common.v1.TimeType time_type = 3;
  common.v1.TimeFilterRange time_range = 4;
}

message ExpenseTimeMetricResponse {
  double expense_total = 1;
  map<int64, KeyValueMetricList> data = 2;
}

message ExpenseOverviewMetricRequest {
  uint64 team_id = 1;
  common.v1.TimeFilterRange time_range = 2;
}

message ExpenseOverviewMetricResponse {
  double expense_total = 1;
  map<string, double> expense_details = 2;
}

enum ExpenseType {
  EXPENSE_TYPE_UNSPECIFIED = 0;
  EXPENSE_TYPE_INTERNAL = 1;
  EXPENSE_TYPE_SELLING = 2;
  EXPENSE_TYPE_WAREHOUSE = 3;
}

message ExpenseTypeListRequest {
  ExpenseType type = 1;
}
message ExpenseTypeListResponse {
  string message = 1;
  repeated common.v1.KeyName data = 2;
}

message ExpenseItem {
  uint64 id = 1;
  uint64 team_id = 2;
  uint64 created_by_id = 3;
  string desc = 4;
  ExpenseType expense_type = 5;
  string expense_key = 9;
  double amount = 6;
  int64 expense_at = 7;
  int64 created_at = 8;
}

message ExpenseCreateRequest {
  uint64 team_id = 1;
  string ref_id = 7;
  string desc = 2;
  ExpenseType expense_type = 3;
  string expense_key = 4;
  double amount = 5;
  common.v1.RequestFrom request_from = 8 [(buf.validate.field).enum = {
    defined_only: true
    not_in: [0]
  }];
  // google.protobuf.Timestamp expense_at = 6;
}

message ExpenseCreateResponse {
  string message = 1;
}

message ExpenseListRequest {
  uint64 team_id = 1;
  uint64 by_user_id = 2;
  ExpenseType expense_type = 5;
  string expense_key = 6;
  common.v1.TimeFilterRange time_range = 3;
  common.v1.PageFilter page = 4;
  common.v1.RequestFrom request_from = 7 [(buf.validate.field).enum = {
    defined_only: true
    not_in: [0]
  }];
}

message ExpenseListResponse {
  string message = 1;
  repeated ExpenseItem data = 2;
  common.v1.PageInfo page_info = 3;
}
