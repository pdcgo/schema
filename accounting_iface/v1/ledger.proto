syntax = "proto3";
package accounting_iface.v1;

import "buf/validate/validate.proto";
import "common/v1/common.proto";

option go_package = "github.com/pdcgo/schema/services/accounting_iface/v1;accounting_iface";

service LedgerService {
  rpc EntryList(EntryListRequest) returns (EntryListResponse);
  rpc EntryListExport(EntryListExportRequest) returns (stream EntryListExportResponse);
}

message EntryListExportRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  string account_key = 2 [(buf.validate.field).string.min_len = 1];
  FilterExtra extra = 6;
  common.v1.TimeFilter time_range = 3 [(buf.validate.field).required = true];
}

message EntryListExportResponse {
  string message = 1;
  int64 offset = 2;
  int64 total = 3;
  bytes data = 4;
}

enum EntryFieldSort {
  ENTRY_FIELD_SORT_UNSPECIFIED = 0;
  ENTRY_FIELD_SORT_ENTRYTIME = 1;
}

message EntryListSort {
  EntryFieldSort field = 1;
  common.v1.SortType type = 2;
}

message FilterExtra {
  uint64 customer_service_id = 1;
  uint64 shop_id = 2;
  uint64 supplier_id = 3;
}

message EntryListRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  string account_key = 2 [(buf.validate.field).string.min_len = 1];
  FilterExtra extra = 6;
  common.v1.TimeFilter time_range = 3 [(buf.validate.field).required = true];
  common.v1.PageFilter page = 4 [(buf.validate.field).required = true];
  EntryListSort sort = 5;
}

message EntryAccount {
  uint64 id = 1;
  uint64 team_id = 2;
  string account_key = 3;
  string name = 4;
}

message EntryItem {
  uint64 id = 1;
  uint64 account_id = 2;
  int64 entry_time = 3;
  string desc = 5;
  double debit = 6;
  double credit = 7;
  double balance = 8;

  EntryAccount account = 9;
}

message EntryListResponse {
  repeated EntryItem data = 1;
  common.v1.PageInfo page_info = 2;
}
