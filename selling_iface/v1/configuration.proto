syntax = "proto3";
package selling_iface.v1;

// import "accounting_iface/v1/core.proto";
// import "accounting_iface/v1/revenue.proto";
import "buf/validate/validate.proto";
import "common/v1/common.proto";
// import "google/protobuf/timestamp.proto";

option go_package = "github.com/pdcgo/schema/services/selling_iface/v1;selling_iface";

service ConfigurationLimitService {
  rpc LimitInvoice(LimitInvoiceRequest) returns (LimitInvoiceResponse);
  // owe terbaru
  rpc OweDefaultLimitGet(OweDefaultLimitGetRequest) returns (OweDefaultLimitGetResponse);
  rpc OweDefaultLimitEdit(OweDefaultLimitEditRequest) returns (OweDefaultLimitEditResponse);
  rpc OweLimitCustomCreate(OweLimitCustomCreateRequest) returns (OweLimitCustomCreateResponse);
  rpc OweLimitCustomList(OweLimitCustomListRequest) returns (OweLimitCustomListResponse);
  rpc OweLimitCustomDelete(OweLimitCustomDeleteRequest) returns (OweLimitCustomDeleteResponse);
  rpc OweLimitCustomByIDs(OweLimitCustomByIDsRequest) returns (OweLimitCustomByIDsResponse);
  rpc CheckOweLimit(CheckOweLimitRequest) returns (CheckOweLimitResponse);
}

message OweDefaultLimitGetRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
}
message OweDefaultLimitGetResponse {
  uint64 id = 1;
  uint64 team_id = 2;
  bool is_default = 4;
  double threshold = 5;
}

message OweLimitCustomDeleteRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 for_team_id = 2 [(buf.validate.field).uint64.gt = 0];
}

message OweLimitCustomDeleteResponse {}

message OweDefaultLimitEditRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  double threshold = 2;
}

message OweDefaultLimitEditResponse {}

message OweLimitCustomCreateRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 for_team_id = 3 [(buf.validate.field).uint64.gt = 0];
  double threshold = 4 [(buf.validate.field).double.gt = 0];
}
message OweLimitCustomCreateResponse {
  uint64 id = 1;
}

message OweLimitItem {
  uint64 id = 1;
  uint64 team_id = 2;
  uint64 for_team_id = 3;
  bool is_default = 4;
  double threshold = 5;
}

message OweLimitCustomListRequest {
  string q = 1;
  uint64 team_id = 2 [(buf.validate.field).uint64.gt = 0];
  common.v1.PageFilter page = 3 [(buf.validate.field).required = true];
}
message OweLimitCustomListResponse {
  repeated OweLimitItem data = 1;
  common.v1.PageInfo page_info = 2;
}

message CheckOweLimitRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  repeated uint64 cfg_team_ids = 2 [
    (buf.validate.field).repeated.min_items = 1,
    (buf.validate.field).repeated.max_items = 100,
    (buf.validate.field).repeated.unique = true,
    (buf.validate.field).repeated.items.uint64.gt = 0
  ];
}

message OweLimitAllow {
  bool allow = 1;
  double active_amount = 2;
  double threshold = 3;
}

message CheckOweLimitResponse {
  map<uint64, OweLimitAllow> can_owe = 1;
}

message OweLimitCustomByIDsItem {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 cfg_team_id = 2 [(buf.validate.field).uint64.gt = 0];
}

message OweLimitCustomByIDsRequest {
  bool include_active = 1;
  repeated OweLimitCustomByIDsItem items = 2 [(buf.validate.field).repeated = {min_items: 1}];
}

message OweLimitDetailItem {
  OweLimitItem limit = 1;
  double active_amount = 2;
}

message OweLimitCustomByIDsResponse {
  repeated OweLimitDetailItem data = 1;
}

message LimitInvoiceItemReq {
  uint64 from_team_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 to_team_id = 2 [(buf.validate.field).uint64.gt = 0];
}

message LimitInvoiceRequest {
  repeated LimitInvoiceItemReq limit = 1 [(buf.validate.field).repeated = {min_items: 1}];
}

message LimitInvoiceItem {
  uint64 id = 1;
  uint64 from_team_id = 2;
  uint64 to_team_id = 3;
  double threshold = 4;
}

message LimitInvoiceResponse {
  repeated LimitInvoiceItem data = 1;
}
