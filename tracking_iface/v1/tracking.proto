syntax = "proto3";
package tracking_iface.v1;

// import "accounting_iface/v1/core.proto";
import "buf/validate/validate.proto";
// import "common/v1/common.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/pdcgo/schema/services/tracking_iface/v1;tracking_iface";

service TrackingService {
  rpc TrackingGet(TrackingGetRequest) returns (TrackingGetResponse);
  rpc TrackingProcess(TrackingProcessRequest) returns (TrackingProcessResponse);
}

message OrderShipped {
  uint64 order_id = 1 [(buf.validate.field).required = true];
  uint64 tx_id = 2 [(buf.validate.field).required = true];
  uint64 team_id = 3 [(buf.validate.field).required = true];
}

message TrackingPayload {
  uint64 shipping_id = 1 [(buf.validate.field).required = true];
  string receipt = 2 [(buf.validate.field).required = true];
  oneof type {
    OrderShipped order_shipped = 3;
  }
}

message TrackingGetRequest {
  TrackingPayload payload = 1 [(buf.validate.field).required = true];
}

message HistoryItem {
  string name = 1;
  string desc = 2;
  google.protobuf.Timestamp at = 3;
}

message Shipping {
  string key = 1;
  string display_name = 2;
}

enum Status {
  STATUS_UNSPECIFIED = 0;
  STATUS_DELIVERED = 1;
  STATUS_ON_PROCESS = 2;
  STATUS_RETURN_PROCESS = 3;
  STATUS_RETURNED = 4;
  STATUS_SHIPMENT_PROCESS = 5;
  STATUS_LOST = 6;
  STATUS_DELIVERY_FAILED = 7;
  STATUS_CANCEL = 8;
  STATUS_CREATED = 9;
}

enum Thirdparty {
  THIRDPARTY_UNSPECIFIED = 0;
  THIRDPARTY_TONI_UNDERGROUND = 1;
  THIRDPARTY_RAJAONGKIR = 2;
  THIRDPARTY_SPX_UNDERGROUND = 3;
}

message TrackInfo {
  uint64 id = 1;
  uint64 shipping_id = 2;
  string receipt = 3;
  google.protobuf.Timestamp last_updated = 4;
  Shipping shipping = 5;

  Status status = 6;
  repeated HistoryItem histories = 7;
  repeated Thirdparty thirdparties = 8;
}

message TrackingGetResponse {
  TrackInfo track_info = 1;
}

message TrackingProcessRequest {
  TrackingPayload payload = 1 [(buf.validate.field).required = true];
}

message TrackingProcessResponse {
  TrackInfo track_info = 1;
}
