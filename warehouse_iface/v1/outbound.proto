syntax = "proto3";

package warehouse_iface.v1;

import "buf/validate/validate.proto";
import "common/v1/common.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/pdcgo/schema/services/warehouse_iface/v1;warehouse_iface";

service OutboundService {
  rpc OutboundList(OutboundListRequest) returns (OutboundListResponse);
  rpc OutboundDetail(OutboundDetailRequest) returns (OutboundDetailResponse);
  rpc OutboundDetailIDs(OutboundDetailIDsRequest) returns (OutboundDetailIDsResponse);
  rpc OrderDetailSearch(OrderDetailSearchRequest) returns (OrderDetailSearchResponse);
}

enum OrderDetailSearchType {
  ORDER_DETAIL_SEARCH_TYPE_UNSPECIFIED = 0;
  ORDER_DETAIL_SEARCH_TYPE_RECEIPT = 1;
}

enum OutboundDetailSearchType {
  OUTBOUND_DETAIL_SEARCH_TYPE_UNSPECIFIED = 0;
  OUTBOUND_DETAIL_SEARCH_TYPE_TXID = 1;
  OUTBOUND_DETAIL_SEARCH_TYPE_RECEIPT_ORDREF = 2;
}

message OutboundDetailIDsRequest {
  repeated uint64 tx_ids = 1 [(buf.validate.field).repeated = {
    min_items: 1 // must have at least 1 id
    max_items: 1000
  }];
  bool load_all = 4;
}

message OutboundDetailIDsResponse {
  map<uint64, OutboundDetailResponse> data = 1;
}

message OutboundDetailRequest {
  OutboundDetailSearchType search_type = 1 [(buf.validate.field).enum = {
    not_in: [0]
  }];
  string q = 2;
  uint64 tx_id = 3;
  bool load_all = 4;
}

message OrderDetail {
  uint64 id = 1;
  uint64 team_id = 2;
  uint64 create_by_id = 3;
  uint64 invertory_tx_id = 4;
  uint64 invertory_return_tx_id = 5;
  bool double_order = 6;
  string order_ref_id = 7;
  string order_from = 8;
  google.protobuf.Timestamp order_time = 9;
}

message OutboundDetailResponse {
  Outbound outbound = 2;
  oneof extra {
    OrderDetail order_detail = 1;
  }
}

message OrderDetailSearchRequest {
  OrderDetailSearchType search_type = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum = {
      not_in: [0]
    }
  ];
  string q = 2 [(buf.validate.field).string = {min_len: 1}];
}

message TransactionDetail {
  uint64 id = 1;
  uint64 team_id = 2;
  uint64 warehouse_id = 3;
  uint64 create_by_id = 4;
  uint64 verify_by_id = 5;
  uint64 shipping_id = 6;
  string extern_ord_id = 7;
  string receipt = 8;
  string receipt_file = 9;
  string type = 10;
  string status = 11;
  bool is_shipped = 12;
  double total = 13;
  google.protobuf.Timestamp created = 14;
  google.protobuf.Timestamp send_at = 15;
  google.protobuf.Timestamp arrived = 16;
}

message OrderDetailSearchResponse {
  OrderDetail order = 1;
  TransactionDetail outbound = 2;
  TransactionDetail inbound = 3;
}

enum ShipmentStatus {
  SHIPMENT_STATUS_UNSPECIFIED = 0;
  SHIPMENT_STATUS_UNSEND = 1;
  SHIPMENT_STATUS_SEND = 2;
}

enum OutboundSortField {
  OUTBOUND_SORT_FIELD_UNSPECIFIED = 0;
  OUTBOUND_SORT_FIELD_CREATED = 1;
  OUTBOUND_SORT_FIELD_MP_CREATED = 2;
}

enum OutboundType {
  OUTBOUND_TYPE_UNSPECIFIED = 0;
  OUTBOUND_TYPE_ORDER = 1;
  OUTBOUND_TYPE_TRANSFER_OUT = 2;
}

enum OutboundSearchType {
  OUTBOUND_SEARCH_TYPE_UNSPECIFIED = 0;
  OUTBOUND_SEARCH_TYPE_SHOPNAME = 1;
  OUTBOUND_SEARCH_TYPE_ORDER_RECEIPT = 2;
}

message OutboundSort {
  OutboundSortField field = 1;
  common.v1.SortType type = 2;
}

message OutboundListFilter {
  uint64 team_id = 1;
  uint64 user_id = 2;
  uint64 shop_id = 7;
  string q = 3;
  OutboundSearchType search_type = 12;
  bool include_deleted = 10;
  ShipmentStatus shipment = 11;
  repeated string status = 4;
  repeated uint64 shipping_ids = 5;
  repeated common.v1.MarketplaceType marketplaces = 6;
  OutboundType outbound_type = 8;
  common.v1.TimeFilterRange time_range = 9 [(buf.validate.field).required = true];
}

message OutboundListRequest {
  OutboundListFilter filter = 1 [(buf.validate.field).required = true];
  OutboundSort sort = 2 [(buf.validate.field).required = true];
  common.v1.PageFilter page = 3 [(buf.validate.field).required = true];
}

message SkuDataDetail {
  uint64 product_id = 1;
  uint64 variant_id = 2;
  uint64 warehouse_id = 3;
  uint64 team_id = 4;
}

message OutboundItem {
  uint64 id = 1;
  string sku_id = 2;
  bool owned = 3;
  int64 count = 4;
  double price = 5;
  double total = 6;
  SkuDataDetail sku_detail = 7;
}

message Order {
  uint64 id = 1;
  uint64 shop_id = 2;
  uint64 customer_id = 3;
  google.protobuf.Timestamp order_time = 4;
}

message TransferFrom {
  uint64 id = 1;
  uint64 warehouse_id = 2;
}

message Outbound {
  uint64 id = 1;
  uint64 team_id = 2;
  uint64 warehouse_id = 3;
  uint64 create_by_id = 4;
  repeated OutboundItem items = 5;
  string status = 7;
  string receipt = 8;
  string extern_ord_id = 15;
  string receipt_file = 9;
  bool is_deleted = 11;
  bool is_shipped = 6;
  uint64 shipping_id = 14;

  google.protobuf.Timestamp created = 10;

  oneof extra {
    Order order = 12;
    TransferFrom transfer_from = 13;
  }
}

message OutboundListResponse {
  repeated Outbound data = 1;
  common.v1.PageInfo page_info = 2;
}
