syntax = "proto3";

package warehouse_iface.v1;

import "buf/validate/validate.proto";
import "common/v1/common.proto";
// import "google/protobuf/timestamp.proto";

option go_package = "github.com/pdcgo/schema/services/warehouse_iface/v1;warehouse_iface";

service WarehouseService {
  rpc WarehouseIDs(WarehouseIDsRequest) returns (WarehouseIDsResponse);
  rpc WarehouseList(WarehouseListRequest) returns (WarehouseListResponse);
  rpc TeamWarehouseReturnInfo(TeamWarehouseReturnInfoRequest) returns (TeamWarehouseReturnInfoResponse);

  rpc TransactionNoteCreate(TransactionNoteCreateRequest) returns (TransactionNoteCreateResponse);
  rpc TransactionNoteList(TransactionNoteListRequest) returns (TransactionNoteListResponse);
}

enum TransactionNoteType {
  TRANSACTION_NOTE_TYPE_UNSPECIFIED = 0;
  TRANSACTION_NOTE_TYPE_COMMON = 1;
  TRANSACTION_NOTE_TYPE_RETURN = 2;
  TRANSACTION_NOTE_TYPE_CANCEL = 3;
  TRANSACTION_NOTE_TYPE_BROKEN = 4;
  TRANSACTION_NOTE_TYPE_PROBLEM = 5;
}

message Note {
  TransactionNoteType type = 5;
  string note_text = 6;
}

message TransactionNoteCreateRequest {
  uint64 tx_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 team_id = 2 [(buf.validate.field).uint64.gt = 0];
  uint64 order_id = 3;

  repeated Note notes = 4 [(buf.validate.field).repeated = {max_items: 5}];
}

message TransactionNoteCreateResponse {
  repeated uint64 ids = 1;
}

message TransactionNoteListRequest {
  uint64 tx_id = 1 [(buf.validate.field).uint64.gt = 0];
  uint64 team_id = 2 [(buf.validate.field).uint64.gt = 0];
  uint64 order_id = 3;
}
message TransactionNoteListResponse {
  repeated Note list = 1;
}

message Warehouse {
  uint64 id = 1;
  string name = 2;
  string desc = 3;
}

message WarehouseIDsRequest {
  repeated uint64 ids = 1 [(buf.validate.field).repeated = {
    min_items: 1 // must have at least 1 id
    max_items: 200
    unique: true // no duplicate IDs allowed
    items: {
      uint64: {gt: 0}
    }
  }];
}

message WarehouseIDsResponse {
  map<uint64, Warehouse> data = 1;
}

message WarehouseListRequest {}
message WarehouseListResponse {
  repeated Warehouse list = 1;
}

message TeamWarehouseReturnInfoRequest {
  uint64 team_id = 1;
}

message TeamWarehouseReturnInfoResponse {
  Warehouse warehouse_return = 1;
  common.v1.User user_return = 2;
}
