syntax = "proto3";
package withdrawal_iface.v2;

import "buf/validate/validate.proto";
import "common/v1/common.proto";
import "withdrawal_iface/v1/withdrawal.proto";

option go_package = "github.com/pdcgo/schema/services/withdrawal_iface/v2;withdrawal_iface";

enum LogLevel {
  LOG_LEVEL_UNSPECIFIED = 0;
  LOG_LEVEL_WARN = 1;
  LOG_LEVEL_ERROR = 2;
}

service WithdrawalService {
  rpc SubmitWithdrawal(SubmitWithdrawalRequest) returns (stream SubmitWithdrawalResponse);
  rpc SubmitWithdrawalTiktok(SubmitWithdrawalTiktokRequest) returns (stream SubmitWithdrawalTiktokResponse);
}

message MpSubmit {
  uint64 mp_id = 2 [(buf.validate.field).uint64.gt = 0];
  common.v1.MarketplaceType mp_type = 4 [(buf.validate.field).enum.defined_only = true];
}

message SubmitWithdrawalRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  withdrawal_iface.v1.ImporterSource source = 3 [(buf.validate.field).enum.defined_only = true];
  string resource_uri = 5 [(buf.validate.field).string.min_len = 1];
  MpSubmit mp_submit = 6 [(buf.validate.field).required = true];
}

message SubmitWithdrawalResponse {
  string message = 1;
  LogLevel level = 2;
}

message SubmitWithdrawalTiktokRequest {
  uint64 team_id = 1 [(buf.validate.field).uint64.gt = 0];
  withdrawal_iface.v1.ImporterSource source = 3 [(buf.validate.field).enum.defined_only = true];
  string resource_uri = 5 [(buf.validate.field).string.min_len = 1];
  MpSubmit mp_submit = 6 [(buf.validate.field).required = true];
}

message SubmitWithdrawalTiktokResponse {
  string message = 1;
  LogLevel level = 2;
}
